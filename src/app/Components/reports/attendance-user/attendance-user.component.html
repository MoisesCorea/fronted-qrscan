<form [formGroup]="reportForm" (ngSubmit)="onSubmit()" class="container mt-5">
  <div class="row">
    <div class="form-group col-md-2">
      <label class="form-label" for="name">Correo:</label>
      <input type="text" class="form-control" id="name" [formControl]="email" />
      <div
        *ngIf="email.errors && isValidForm != null && !isValidForm"
        class="text-danger"
      >
        <div *ngIf="email.errors.required">El correo es requerido</div>
        <div *ngIf="email.errors.pattern">
          El correo no tiene un formato valido
        </div>
        <div *ngIf="email.errors.maxlength">
          El correo debe tener una longitud m√°xima de 255 caracteres
        </div>
      </div>
    </div>

    <div class="form-group col-md-2">
      <label class="form-label" for="initial_date">Fecha Inicial:</label>
      <input
        type="date"
        class="form-control"
        id="initial_date"
        [formControl]="initial_date"
      />
      <div
        *ngIf="initial_date.errors && isValidForm != null && !isValidForm"
        class="text-danger"
      >
        <div *ngIf="initial_date.errors.required">
          La fecha inicial es requerida
        </div>
      </div>
    </div>

    <div class="form-group col-md-2">
      <label class="form-label" for="end_date">Fecha Final:</label>
      <input
        type="date"
        class="form-control"
        id="end_date"
        [formControl]="end_date"
      />
      <div
        *ngIf="end_date.errors && isValidForm != null && !isValidForm"
        class="text-danger"
      >
        <div *ngIf="end_date.errors.required">La fecha final es requerida</div>
      </div>
    </div>

    <div class="form-group col-md-3">
      <label class="form-label" for="roles">Evento:</label>
      <select class="form-control" [formControl]="events" required>
        <option [ngValue]="null" selected>-- Seleccionar --</option>
        <option *ngFor="let event of eventsList" [ngValue]="event.id">
          {{ event.name }}
        </option>
      </select>
      <div
        *ngIf="events.errors && isValidForm != null && !isValidForm"
        [ngClass]="'error'"
      >
        <div *ngIf="events.errors.required">Selecciona un rol de usuario</div>
      </div>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary addBtn">Generar</button>
    </div>
  </div>
</form>

<div *ngIf="reportData" class="container mt-5">
  <h2>Reporte de Asistencia</h2>
  <p><strong>Nombre del Usuario:</strong> {{ reportData.user_name }}</p>
  <p><strong>Nombre del Turno:</strong> {{ reportData.shift_name }}</p>
  <p><strong>Nombre del evento:</strong> {{ reportData.event_name }}</p>
  <p><strong>Asistencia diaria:</strong> {{ reportData.daily_attendance }}</p>
  <p *ngIf="reportData.daily_attendance === 'Si'">
    <strong>Tiempo No Dedicado Total (minutos):</strong>
    {{ reportData.total_non_didicated_time }}
  </p>
  <p>
    <strong>Tiempo Dedicado Total (Horas):</strong>
    {{ reportData.total_dedicated_hours }}
  </p>

  <h3>Asistencias</h3>
  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Fecha</th>
        <th>Hora de Entrada</th>
        <th>Hora de Salida</th>
        <th *ngIf="reportData.daily_attendance === 'Si'">Minutos Tarde</th>
        <th *ngIf="reportData.daily_attendance === 'Si'">
          Minutos de Salida Temprana
        </th>
        <th *ngIf="reportData.daily_attendance === 'Si'">
          Tiempo no dedicado (minutos)
        </th>
        <th>Tiempo dedicado (horas)</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let attendance of reportData.attendances">
        <td>{{ attendance.attendance_date }}</td>
        <td>{{ attendance.entry_time }}</td>
        <td>{{ attendance.finish_time }}</td>
        <td *ngIf="reportData.daily_attendance === 'Si'">
          {{ attendance.minutes_late }}
        </td>
        <td *ngIf="reportData.daily_attendance === 'Si'">
          {{ attendance.minutes_early_leaving }}
        </td>
        <td *ngIf="reportData.daily_attendance === 'Si'">
          {{ attendance.time_non_dedicated }}
        </td>
        <td>{{ attendance.time_dedicated }}</td>
      </tr>
    </tbody>
  </table>
</div>
